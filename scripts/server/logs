#!/bin/bash

# Docker Compose ProductionÁí∞Â¢É„ÅÆ„É≠„Ç∞„ÇíË°®Á§∫„Åô„Çã„Çπ„ÇØ„É™„Éó„Éà

set -e

# „Çπ„ÇØ„É™„Éó„Éà„ÅÆ„Éá„Ç£„É¨„ÇØ„Éà„É™„ÇíÂèñÂæó
SCRIPT_DIR="$(cd "$(dirname "${BASH_SOURCE[0]}")" && pwd)"
PROJECT_ROOT="$(cd "${SCRIPT_DIR}/../.." && pwd)"

# „Éó„É≠„Ç∏„Çß„ÇØ„Éà„É´„Éº„Éà„Å´ÁßªÂãï
cd "${PROJECT_ROOT}"

# „Ç™„Éó„Ç∑„Éß„É≥Ëß£Êûê
FOLLOW_MODE=""
SERVICE=""

while [[ $# -gt 0 ]]; do
    case $1 in
        -f|--follow)
            FOLLOW_MODE="-f"
            shift
            ;;
        web|queue)
            SERVICE="$1"
            shift
            ;;
        *)
            echo "Usage: $0 [-f|--follow] [web|queue]"
            echo ""
            echo "Options:"
            echo "  -f, --follow    Follow log output (live mode)"
            echo ""
            echo "Services:"
            echo "  web            Show only web server logs"
            echo "  queue          Show only queue worker logs"
            echo "  (no service)   Show all logs"
            echo ""
            echo "Examples:"
            echo "  script/server/logs          # Show all logs"
            echo "  script/server/logs -f       # Follow all logs"
            echo "  script/server/logs web      # Show web server logs"
            echo "  script/server/logs -f queue # Follow queue worker logs"
            exit 1
            ;;
    esac
done

echo "üìã Showing Lofi BGM Production logs..."
if [ -n "$SERVICE" ]; then
    echo "üéØ Service: $SERVICE"
fi
if [ -n "$FOLLOW_MODE" ]; then
    echo "üì° Live mode (Ctrl+C to exit)"
fi
echo ""

# „É≠„Ç∞„ÇíË°®Á§∫
docker compose -f docker-compose.production.yml logs $FOLLOW_MODE $SERVICE