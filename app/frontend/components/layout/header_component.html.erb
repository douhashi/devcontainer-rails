<header class="layout-header" data-testid="layout-header">
  <div class="flex items-center justify-between px-6 h-full">
    <div class="flex items-center gap-4">
      <% if show_menu_toggle %>
        <button type="button" 
                class="md:hidden text-gray-400 hover:text-gray-100 p-2 rounded-md"
                data-action="click->layout#toggleSidebar"
                aria-label="Toggle menu">
          <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"/>
          </svg>
        </button>
      <% end %>
      
      <h1 class="text-xl font-semibold text-gray-100">
        <%= link_to title, root_path, class: "hover:text-white transition-colors" %>
      </h1>
    </div>
    
    <% if user_signed_in? %>
      <div class="relative" data-controller="user-dropdown" data-testid="user-dropdown">
        <button type="button" 
                class="flex items-center gap-3 px-3 py-2 rounded-md hover:bg-gray-700 transition-colors"
                data-action="click->user-dropdown#toggle"
                role="button"
                aria-haspopup="true"
                aria-expanded="false">
          <div class="text-sm text-gray-400" data-testid="user-email-display">
            <%= truncated_email %>
          </div>
          <div class="w-8 h-8 bg-gray-600 rounded-full flex items-center justify-center">
            <span class="text-sm font-medium text-gray-100"><%= user_avatar_initial %></span>
          </div>
        </button>
        
        <div class="absolute right-0 mt-2 w-64 bg-gray-800 border border-gray-700 rounded-md shadow-lg z-50 hidden"
             data-user-dropdown-target="menu"
             role="menu"
             tabindex="-1">
          <div class="px-4 py-3 border-b border-gray-700">
            <div class="text-sm text-gray-300">
              <%= current_user.email %>
            </div>
          </div>
          
          <div class="py-1">
            <%= link_to destroy_user_session_path, 
                        method: :delete,
                        data: { turbo_method: :delete },
                        class: "block px-4 py-2 text-sm text-gray-300 hover:bg-gray-700 hover:text-white transition-colors",
                        role: "menuitem" do %>
              ログアウト
            <% end %>
          </div>
        </div>
      </div>
    <% else %>
      <div class="flex items-center gap-4" data-testid="user-info">
        <div class="text-sm text-gray-400">
          Admin User
        </div>
        <div class="w-8 h-8 bg-gray-600 rounded-full flex items-center justify-center">
          <span class="text-sm font-medium text-gray-100">A</span>
        </div>
      </div>
    <% end %>
  </div>
</header>