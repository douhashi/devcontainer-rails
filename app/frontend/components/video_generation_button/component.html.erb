<div class="video-generation-section">
  <!-- Current Video Status (if exists) -->
  <% if video_exists? %>
    <div class="mb-4 p-4 bg-gray-900 rounded-lg">
      <div class="flex items-center justify-between mb-3">
        <h3 class="text-lg font-medium text-gray-200 flex items-center">
          <span class="mr-2"><%= status_icon %></span>
          動画ステータス
        </h3>
        <span class="text-sm text-gray-400">
          <%= time_tag video_info[:created_at], "#{video_info[:created_at].strftime('%Y/%m/%d %H:%M')}" %>
        </span>
      </div>
      
      <div class="flex items-center justify-between">
        <div class="flex-1">
          <% case video_status %>
          <% when 'pending' %>
            <p class="text-yellow-400">生成待機中です</p>
          <% when 'processing' %>
            <p class="text-blue-400">動画を生成しています...</p>
            <p class="text-sm text-gray-400 mt-1">YouTube最適化設定で処理中（数分かかります）</p>
          <% when 'completed' %>
            <p class="text-green-400">動画が正常に生成されました</p>
            <% if video_file_url %>
              <div class="mt-2">
                <video controls class="w-full max-w-md rounded-lg">
                  <source src="<%= video_file_url %>" type="video/mp4">
                  お使いのブラウザは動画再生をサポートしていません。
                </video>
              </div>
              <div class="mt-2 flex gap-4">
                <%= link_to "ダウンロード", video_file_url, 
                      class: "text-blue-400 hover:text-blue-300 text-sm underline",
                      target: "_blank",
                      download: "#{content_record.theme}_video.mp4" %>
                <%= link_to "動画詳細", content_video_path(content_record), 
                      class: "text-purple-400 hover:text-purple-300 text-sm underline" %>
              </div>
            <% end %>
            <% if video_info[:resolution] || video_info[:file_size] || video_info[:duration_seconds] %>
              <div class="mt-2 text-sm text-gray-500 space-y-1">
                <% if video_info[:resolution] %>
                  <div>解像度: <%= video_info[:resolution] %></div>
                <% end %>
                <% if video_info[:file_size] %>
                  <div>ファイルサイズ: <%= formatted_file_size(video_info[:file_size]) %></div>
                <% end %>
                <% if video_info[:duration_seconds] %>
                  <div>再生時間: <%= formatted_duration(video_info[:duration_seconds]) %></div>
                <% end %>
              </div>
            <% end %>
          <% when 'failed' %>
            <p class="text-red-400">動画生成に失敗しました</p>
            <% if content_record.video.error_message %>
              <p class="text-sm text-red-300 mt-1">
                エラー: <%= content_record.video.error_message %>
              </p>
            <% end %>
          <% end %>
        </div>
      </div>
    </div>
  <% end %>

  <!-- Prerequisites Check -->
  <% unless can_generate_video? %>
    <div class="mb-4 p-4 bg-yellow-900 bg-opacity-20 border border-yellow-500 rounded-lg">
      <div class="flex items-center mb-2">
        <span class="text-yellow-400 text-lg mr-2">⚠️</span>
        <h4 class="text-yellow-400 font-medium">動画生成の前提条件</h4>
      </div>
      <ul class="text-yellow-200 text-sm space-y-1">
        <% prerequisite_errors.each do |error| %>
          <li class="flex items-start">
            <span class="mr-2 mt-0.5">•</span>
            <%= error %>
          </li>
        <% end %>
      </ul>
    </div>
  <% end %>

  <!-- Generation Button -->
  <div class="flex items-center gap-4">
    <% if can_generate_video? %>
      <%= button_to content_video_path(content_record), 
            method: :post,
            class: button_classes,
            disabled: disabled?,
            data: {
              controller: "video-generation",
              action: "click->video-generation#generate",
              video_generation_content_id_value: content_record.id,
              turbo_confirm: (video_status == 'completed' ? "既存の動画を置き換えます。よろしいですか？" : nil)
            } do %>
        <span class="mr-2"><%= status_icon %></span>
        <%= button_text %>
        <% if processing? %>
          <svg class="animate-spin ml-2 h-4 w-4 text-white" fill="none" viewBox="0 0 24 24">
            <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
            <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
          </svg>
        <% end %>
      <% end %>
    <% else %>
      <button disabled class="<%= button_classes %>">
        <span class="mr-2">🚫</span>
        <%= button_text %>
      </button>
    <% end %>

    <!-- Delete Button (if video exists) -->
    <% if video_exists? && video_status == 'completed' %>
      <%= button_to content_video_path(content_record), 
            method: :delete,
            class: "inline-flex items-center px-4 py-2 rounded-lg font-medium transition-all duration-200 bg-red-600 hover:bg-red-700 text-white text-sm",
            data: {
              turbo_confirm: "動画を削除しますか？"
            } do %>
        <span class="mr-1">🗑️</span>
        削除
      <% end %>
    <% end %>

    <!-- Help Text -->
    <div class="text-sm text-gray-400">
      <% if can_generate_video? %>
        音源とアートワークから YouTube 最適化動画を生成します
      <% else %>
        上記の条件を満たしてから動画生成を実行してください
      <% end %>
    </div>
  </div>
</div>

